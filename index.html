<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant - Working Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Simple animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(45deg, #ff4444, #44ff44, #4444ff);
            background-size: 200% 200%;
            animation: pulse 1.5s infinite, gradient 3s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .wave-bar {
            display: inline-block;
            width: 3px;
            height: 15px;
            background: #4f46e5;
            margin: 0 1px;
            animation: wave 1s infinite ease-in-out;
        }
        
        .wave-bar:nth-child(2) { animation-delay: -0.9s; }
        .wave-bar:nth-child(3) { animation-delay: -0.8s; }
        .wave-bar:nth-child(4) { animation-delay: -0.7s; }
        .wave-bar:nth-child(5) { animation-delay: -0.6s; }
        
        @keyframes wave {
            0%, 40%, 100% { transform: scaleY(0.4); }
            20% { transform: scaleY(1.0); }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100" id="body">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                üé§ Voice Assistant
            </h1>
            <p class="text-gray-600">Bolo aur dekho magic!</p>
        </div>

        <!-- Browser Support Check -->
        <div id="browserCheck" class="bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded mb-4 hidden">
            <strong>Warning:</strong> Speech recognition works best in Chrome browser. Other browsers may have issues.
        </div>

        <!-- Main Control Panel -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <!-- Microphone Button -->
            <div class="text-center mb-6">
                <button id="micButton" class="w-24 h-24 bg-blue-500 hover:bg-blue-600 text-white rounded-full text-4xl transition-all duration-300 mx-auto block">
                    üé§
                </button>
                <div id="statusText" class="mt-3 text-lg font-semibold text-gray-700">
                    Click microphone to start
                </div>
                <!-- Wave animation -->
                <div id="waveAnimation" class="mt-3 hidden">
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="flex justify-center gap-3 mb-6">
                <button id="startBtn" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                    ‚ñ∂Ô∏è Start
                </button>
                <button id="stopBtn" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors" disabled>
                    ‚èπÔ∏è Stop
                </button>
                <button id="testBtn" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors">
                    üß™ Test
                </button>
            </div>

            <!-- Current Speech -->
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <h3 class="font-semibold mb-2">What you said:</h3>
                <div id="speechText" class="text-gray-600 min-h-[30px] italic">
                    Nothing yet... speak something!
                </div>
            </div>

            <!-- Debug Info -->
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-semibold mb-2">Debug Info:</h3>
                <div id="debugInfo" class="text-sm text-gray-600">
                    Checking browser compatibility...
                </div>
            </div>
        </div>

        <!-- Results -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">Actions Performed</h2>
            <div id="results" class="space-y-3">
                <div class="text-gray-500 italic text-center py-4">
                    No actions yet. Try these commands:
                    <br><br>
                    <div class="text-sm space-y-1">
                        <div>üîç "search for cats"</div>
                        <div>üåê "open youtube"</div>
                        <div>üé® "change background"</div>
                        <div>‚è∞ "what time is it"</div>
                        <div>üí¨ "message ritika hello"</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let recognition = null;
        let isListening = false;
        let isSupported = false;

        // DOM elements
        const micButton = document.getElementById('micButton');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const testBtn = document.getElementById('testBtn');
        const statusText = document.getElementById('statusText');
        const speechText = document.getElementById('speechText');
        const debugInfo = document.getElementById('debugInfo');
        const results = document.getElementById('results');
        const browserCheck = document.getElementById('browserCheck');
        const waveAnimation = document.getElementById('waveAnimation');
        const body = document.getElementById('body');

        // Check browser support immediately
        function checkBrowserSupport() {
            console.log('Checking browser support...');
            
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                isSupported = true;
                debugInfo.textContent = '‚úÖ Speech Recognition supported!';
                debugInfo.className = 'text-sm text-green-600';
                return true;
            } else {
                isSupported = false;
                debugInfo.textContent = '‚ùå Speech Recognition NOT supported in this browser';
                debugInfo.className = 'text-sm text-red-600';
                browserCheck.classList.remove('hidden');
                return false;
            }
        }

        // Initialize speech recognition
        function initSpeechRecognition() {
            if (!isSupported) {
                addResult('‚ùå Browser does not support speech recognition', 'error');
                return false;
            }

            try {
                // Get the right constructor
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();

                // Basic settings
                recognition.continuous = false; // Changed to false for better reliability
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                recognition.maxAlternatives = 1;

                // Event listeners
                recognition.onstart = function() {
                    console.log('Recognition started');
                    isListening = true;
                    updateUI();
                    addResult('üé§ Started listening...', 'info');
                };

                recognition.onresult = function(event) {
                    console.log('Recognition result:', event);
                    
                    let finalTranscript = '';
                    let interimTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    // Update display
                    const currentText = finalTranscript || interimTranscript;
                    speechText.textContent = currentText || 'Listening...';
                    speechText.className = 'text-gray-800 min-h-[30px]';

                    // Process final result
                    if (finalTranscript.trim()) {
                        console.log('Final transcript:', finalTranscript);
                        processCommand(finalTranscript.trim());
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Recognition error:', event.error);
                    let errorMsg = 'Recognition error: ';
                    
                    switch(event.error) {
                        case 'no-speech':
                            errorMsg += 'No speech detected. Try again.';
                            break;
                        case 'audio-capture':
                            errorMsg += 'No microphone found.';
                            break;
                        case 'not-allowed':
                            errorMsg += 'Microphone permission denied. Please allow microphone access.';
                            break;
                        case 'network':
                            errorMsg += 'Network error occurred.';
                            break;
                        default:
                            errorMsg += event.error;
                    }
                    
                    addResult(errorMsg, 'error');
                    isListening = false;
                    updateUI();
                };

                recognition.onend = function() {
                    console.log('Recognition ended');
                    isListening = false;
                    updateUI();
                };

                debugInfo.textContent = '‚úÖ Speech Recognition initialized successfully!';
                debugInfo.className = 'text-sm text-green-600';
                return true;

            } catch (error) {
                console.error('Error initializing recognition:', error);
                debugInfo.textContent = '‚ùå Error initializing: ' + error.message;
                debugInfo.className = 'text-sm text-red-600';
                return false;
            }
        }

        // Process voice commands
        function processCommand(command) {
            const cmd = command.toLowerCase().trim();
            console.log('Processing command:', cmd);
            
            addResult(`üó£Ô∏è You said: "${command}"`, 'speech');

            // Search command
            if (cmd.includes('search for') || cmd.includes('search')) {
                const query = cmd.replace(/search\s+(for\s+)?/g, '').trim();
                if (query) {
                    const url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                    window.open(url, '_blank');
                    addResult(`üîç Searching for: ${query}`, 'action');
                } else {
                    addResult('‚ùì Search for what?', 'info');
                }
            }
            // Open commands
            else if (cmd.includes('open')) {
                if (cmd.includes('youtube')) {
                    window.open('https://youtube.com', '_blank');
                    addResult('üé• Opening YouTube', 'action');
                } else if (cmd.includes('google')) {
                    window.open('https://google.com', '_blank');
                    addResult('üåê Opening Google', 'action');
                } else if (cmd.includes('whatsapp')) {
                    window.open('https://web.whatsapp.com', '_blank');
                    addResult('üí¨ Opening WhatsApp', 'action');
                } else if (cmd.includes('facebook')) {
                    window.open('https://facebook.com', '_blank');
                    addResult('üë• Opening Facebook', 'action');
                } else {
                    addResult('‚ùì Open what? Try: YouTube, Google, WhatsApp, Facebook', 'info');
                }
            }
            // Background change
            else if (cmd.includes('background') || cmd.includes('color')) {
                changeBackground();
                addResult('üé® Background changed!', 'action');
            }
            // Time
            else if (cmd.includes('time') || cmd.includes('what time')) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString();
                addResult(`‚è∞ Current time: ${timeStr}`, 'info');
            }
            // Message
            else if (cmd.includes('message') || cmd.includes('send')) {
                handleMessage(cmd);
            }
            // Default
            else {
                addResult('‚ùì Command not recognized. Try: search, open, background, time, message', 'info');
            }
        }

        // Handle message command
        function handleMessage(cmd) {
            // Extract name and message
            let name = 'unknown';
            let message = 'hello';
            
            if (cmd.includes('ritika')) {
                name = 'Ritika';
            }
            
            // Try to extract message after name
            const parts = cmd.split(/message|send/);
            if (parts.length > 1) {
                const rest = parts[1].trim();
                const words = rest.split(' ');
                if (words.length > 1) {
                    name = words[0];
                    message = words.slice(1).join(' ');
                }
            }
            
            // Open WhatsApp with message
            const whatsappUrl = `https://web.whatsapp.com/send?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            addResult(`üí¨ Opening WhatsApp to send "${message}" to ${name}`, 'action');
        }

        // Change background
        function changeBackground() {
            const colors = [
                'bg-gradient-to-br from-purple-400 to-pink-400',
                'bg-gradient-to-br from-blue-400 to-indigo-500',
                'bg-gradient-to-br from-green-400 to-teal-500',
                'bg-gradient-to-br from-yellow-400 to-orange-400',
                'bg-gradient-to-br from-red-400 to-pink-400'
            ];
            
            // Remove existing background
            body.className = 'min-h-screen transition-all duration-500';
            
            // Add random color
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            body.className += ' ' + randomColor;
        }

        // Add result to display
        function addResult(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            
            let bgColor = 'bg-blue-50 border-blue-200';
            if (type === 'action') bgColor = 'bg-green-50 border-green-200';
            if (type === 'error') bgColor = 'bg-red-50 border-red-200';
            if (type === 'speech') bgColor = 'bg-purple-50 border-purple-200';
            
            div.className = `p-3 rounded border ${bgColor}`;
            div.innerHTML = `
                <div class="flex justify-between">
                    <span>${message}</span>
                    <span class="text-xs text-gray-500">${time}</span>
                </div>
            `;

            // Clear placeholder
            if (results.querySelector('.text-gray-500.italic')) {
                results.innerHTML = '';
            }

            results.insertBefore(div, results.firstChild);

            // Keep only last 8 results
            while (results.children.length > 8) {
                results.removeChild(results.lastChild);
            }
        }

        // Update UI based on listening state
        function updateUI() {
            if (isListening) {
                statusText.textContent = 'Listening... Speak now!';
                statusText.className = 'mt-3 text-lg font-semibold text-green-600';
                micButton.className = 'w-24 h-24 bg-green-500 text-white rounded-full text-4xl transition-all duration-300 mx-auto block listening';
                startBtn.disabled = true;
                stopBtn.disabled = false;
                waveAnimation.classList.remove('hidden');
            } else {
                statusText.textContent = 'Click microphone to start';
                statusText.className = 'mt-3 text-lg font-semibold text-gray-700';
                micButton.className = 'w-24 h-24 bg-blue-500 hover:bg-blue-600 text-white rounded-full text-4xl transition-all duration-300 mx-auto block';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                waveAnimation.classList.add('hidden');
            }
        }

        // Start listening
        function startListening() {
            if (!isSupported) {
                addResult('‚ùå Speech recognition not supported', 'error');
                return;
            }

            if (!recognition) {
                if (!initSpeechRecognition()) {
                    return;
                }
            }

            if (!isListening) {
                try {
                    speechText.textContent = 'Starting...';
                    recognition.start();
                } catch (error) {
                    console.error('Start error:', error);
                    addResult('‚ùå Error starting: ' + error.message, 'error');
                }
            }
        }

        // Stop listening
        function stopListening() {
            if (recognition && isListening) {
                recognition.stop();
            }
        }

        // Test function
        function testFunction() {
            addResult('üß™ Test: Voice assistant is working!', 'info');
            changeBackground();
        }

        // Event listeners
        micButton.addEventListener('click', () => {
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        });

        startBtn.addEventListener('click', startListening);
        stopBtn.addEventListener('click', stopListening);
        testBtn.addEventListener('click', testFunction);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, initializing...');
            
            // Check support
            if (checkBrowserSupport()) {
                // Initialize recognition
                setTimeout(() => {
                    initSpeechRecognition();
                }, 500);
            }
            
            addResult('üöÄ Voice Assistant loaded! Click microphone to start.', 'info');
        });

        // Request microphone permission on first user interaction
        document.addEventListener('click', function requestMicPermission() {
            if (isSupported && !recognition) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(() => {
                        console.log('Microphone permission granted');
                        debugInfo.textContent = '‚úÖ Microphone permission granted!';
                    })
                    .catch((error) => {
                        console.error('Microphone permission denied:', error);
                        debugInfo.textContent = '‚ùå Microphone permission needed for voice recognition';
                        debugInfo.className = 'text-sm text-red-600';
                    });
                
                // Remove this listener after first attempt
                document.removeEventListener('click', requestMicPermission);
            }
        });
    </script>
</body>
</html>
